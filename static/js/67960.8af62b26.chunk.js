"use strict";(self.webpackChunkn2_station=self.webpackChunkn2_station||[]).push([[67960,89646],{23739:(e,t,i)=>{i.d(t,{Og:()=>c,mh:()=>h,n3:()=>d});var n=i(24648),r=i(9392),s=i(63391),o=i(7137),a=i(80963),l=i(90659);function h(e){const{spatialReference:t}=e;return(0,l.M0)(t,g,f,e)}function c(e,t){if(!(0,a.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return x[0]=e.x,x[1]=e.y,x[2]=e.hasZ?e.z:0,E[0]=t.x,E[1]=t.y,E[2]=t.hasZ?t.z:0,d(x,E,i)}function d(e,t,i){return(0,l.M0)(i,p,u,e,t,i)}function p(e,t,i){return(0,n.d_)((0,o.inverseGeodeticSolver)(v,e,t,i).distance,"meters")}function u(e,t,i){return(0,n.d_)((0,s.geodesicLength)(function(e,t,i){return{type:"polyline",spatialReference:i,paths:[[[...e],[...t]]]}}(e,t,i),"meters"),"meters")}function g(e){return(0,n.d_)((0,o.geodesicLengths)([e],"meters")[0],"meters")}function f(e){return(0,n.d_)((0,s.geodesicLength)(e,"meters"),"meters")}const v=new o.InverseGeodeticSolverResult,x=(0,r.vt)(),E=(0,r.vt)()},67960:(e,t,i)=>{i.d(t,{SelfSnappingEngine:()=>G});var n=i(35143),r=i(91967),s=i(19276),o=i(46053),a=(i(81806),i(76460),i(47249),i(85842)),l=i(73582),h=i(24648),c=i(9392),d=i(12482),p=i(23862),u=i(31633),g=i(19555),f=i(63078),v=i(70330),x=i(17072);class E{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.N.shortLineThreshold*f.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,p.Lp)(e.leftVertex.pos,this.view,t),(0,p.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:n}=i;return 0===this.squaredShortLineThreshold||(0,v.pM)((0,x.j)(t,n,d.qt,this.view),(0,x.j)(e,n,d.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,i){let{spatialReference:n}=i;const r=(0,u.GA)(n);return(0,g.Io)((0,p.Xz)(e),(0,p.Xz)(t))*r<f.N.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}var w=i(45633),m=i(89646),L=i(23739),_=i(79337),V=i(74050);class R extends E{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,r=[];if(n<1)return r;const{spatialReference:s}=t,o=(0,x.j)(e,s,d.qt,this.view),{view:a}=this,l=i.edges[n-1];let h=l;do{if(this.edgeExceedsShortLineThreshold(h,t)){const i=(0,v.is)(h,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,r)}h=h.leftVertex.leftEdge}while(h&&h!==l);return r}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,x.j)(e,o,d.qt,s),l=n.leftEdge,h=n.rightEdge;l&&h&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal((0,p.Lp)(l.leftVertex.pos,s,t),(0,p.Lp)(h.rightVertex.pos,s,t),e,a,t,i);const c=r.edges[0];let u=c;do{if(u!==n.leftEdge&&u!==n.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const n=(0,v.is)(u,s,t);this._processCandidateProposal(n.left,n.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==c);return i}_processCandidateProposal(e,t,i,n,r,s){var o;const{spatialReference:a,pointer:u}=r,g=(0,c.vt)();!function(e,t,i,n,r){(function(e,t,i,n,r){let{spatialReference:s}=r;const o=(0,m.IP)(t,i,s,s);if(null==o)return!1;const a=(0,m.IP)(i,n,s,s);if(null==a)return!1;const c=(0,L.n3)(i,n,s);if(null==c)return!1;const d=Math.abs(l.wf.shortestSignedDiff(o,a))>Math.PI/2?l.uC.normalize(o+Math.PI):o;return(0,m.rT)(e,i,s,(0,h.l3)(c,"meters"),(0,h.Wq)(d,"radians","geographic"),"geodesic"),e[2]=n[2],!0})(e,t,i,n,r)||function(e,t,i,n){(0,_.Yv)(t,{start:i,end:n,type:V.Vv.LINE},e),e[2]=t[2]}(e,n,t,i)}(g,e,t,i,r);const f=(0,p.de)((0,p._7)(g));(0,v.pM)(n,(0,x.j)(f,a,d.qt,this.view))<this.squaredProximityThreshold(u)&&s.push(new w.o({lineStart:e,lineEnd:t,targetPoint:f,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}var S=i(72745),y=i(20612);class P extends E{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,r=i.vertices.length,s=[];if(n<2)return s;const{view:o}=this,a=(0,x.j)(e,t.spatialReference,d.qt,o),l=(0,p.Lp)(i.vertices[r-1].pos,o,t),h=(0,p.Lp)(i.vertices[0].pos,o,t),c=i.edges[n-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const i=(0,v.is)(u,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,s),this._checkEdgeForParallelLines(i,h,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==c);return s}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<3)return i;const{view:s}=this,o=(0,x.j)(e,t.spatialReference,d.qt,s),a=n.leftEdge,l=n.rightEdge,h=r.vertices[0],c=(0,p.Lp)(h.pos,s,t),u=r.vertices.length,g=r.vertices[u-1],f=(0,p.Lp)(g.pos,s,t),E=r.edges[0];let w=E;do{if(w!==a&&w!==l&&this.edgeExceedsShortLineThreshold(w,t)){const r=(0,v.is)(w,s,t);a&&this._checkEdgeForParallelLines(r,(0,p.Lp)(a.leftVertex.pos,s,t),e,o,t,i),l&&this._checkEdgeForParallelLines(r,(0,p.Lp)(l.rightVertex.pos,s,t),e,o,t,i),n===h?this._checkEdgeForParallelLines(r,f,e,o,t,i):n===g&&this._checkEdgeForParallelLines(r,c,e,o,t,i)}w=w.rightVertex.rightEdge}while(w&&w!==E);return i}_checkEdgeForParallelLines(e,t,i,n,r,s){const o=e.left,a=e.right;if((0,V.fg)(T,(0,p.Xz)(t),(0,p.Xz)(o),(0,p.Xz)(a)),(0,g.hG)(T,(0,p.Xz)(t))<f.N.parallelLineThreshold)return;(0,V.fg)(T,(0,p.Xz)(i),(0,p.Xz)(o),(0,p.Xz)(a),(0,p.Xz)(t));const{spatialReference:l,pointer:h}=r,c=(0,p.de)((0,p.fA)(T[0],T[1],i[2]));if((0,v.pM)(n,(0,x.j)(c,l,d.qt,this.view))<this.squaredProximityThreshold(h)){var u;if(this.isVertical(c,t,r)||this.isVertical(o,a,r))return;if(function(e,t){const i=e.left,n=e.right;for(const r of t)if((0,V.fg)(T,(0,p.Xz)(n),(0,p.Xz)(r.constraint.start),(0,p.Xz)(r.constraint.end),(0,p.Xz)(i)),(0,g.hG)(T,(0,p.Xz)(n))<f.N.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}(e,s))return;s.push(new y.B({referenceLine:e,lineStart:t,targetPoint:c,isDraped:"on-the-ground"===(null===(u=r.elevationInfo)||void 0===u?void 0:u.mode)}))}}}const T=(0,S.vt)();var z=i(20664),q=i(75543),X=i(78228);class C extends E{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[];if(i.vertices.length<2)return n;const{view:r}=this,s=(0,x.j)(e,t.spatialReference,d.qt,r),o=i.vertices.at(-1);this._checkForSnappingCandidate(X._b.LastVertex,n,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=i.vertices[0];return this._checkForSnappingCandidate(X._b.FirstVertex,n,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle;if(n.component.vertices.length<3)return i;const{view:r}=this,s=(0,x.j)(e,t.spatialReference,d.qt,r),o=n.leftEdge,a=n.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const n=o.leftVertex.leftEdge;this._checkForSnappingCandidate(X._b.ExistingEdge,i,n,n.rightVertex,n.leftVertex,e,s,t)}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const n=a.rightVertex.rightEdge;this._checkForSnappingCandidate(X._b.ExistingEdge,i,n,n.leftVertex,n.rightVertex,e,s,t)}return i}_checkForSnappingCandidate(e,t,i,n,r,s,o,a){if(!this.edgeExceedsShortLineThreshold(i,a))return;const d=this.view,u=(0,p.Lp)(n.pos,d,a),f=(0,p.Lp)(r.pos,d,a);(function(e,t,i,n,r){(function(e,t,i,n,r){let{spatialReference:s}=r;const o=(0,m.IP)(t,i,s,s);if(null==o)return!1;const a=(0,m.IP)(i,n,s,s);if(null==a)return!1;const d=Math.sign(l.uC.shortestSignedDiff(o,a))*Math.PI*.5,p=(0,h.Wq)(o+d,"radians","geographic"),u=(0,c.vt)(),g=(0,L.n3)(i,n,s);return null!=g&&((0,m.rT)(u,i,s,(0,h.l3)(g,"meters"),p,"geodesic"),(0,z.d)(e,u,i),!0)})(e,t,i,n,r)||function(e,t,i){const n=(0,g.Re)(M,(0,p.Xz)(i),(0,p.Xz)(t));(0,z.i)(e,n[1],-n[0],0)}(e,t,i)})(F,f,u,s,a),this._checkForSnappingCandidateAlongProjectedRay(e,t,f,u,F,s,o,a)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,n,r,s,o,a){var l;const{spatialReference:h,pointer:u}=a,f=(0,g.Re)(M,(0,p.Xz)(s),(0,p.Xz)(n)),E=(0,g.Om)(r,f)/(0,g.m3)(r),w=(0,g.Ln)(M,(0,p.Xz)(n),r,E),m=(0,p.de)((0,p.fA)(w[0],w[1],s[2]));if((0,v.pM)(o,(0,x.j)(m,h,d.qt,this.view))>this.squaredProximityThreshold(u)||this.isVertical(m,n,a)||this.isVertical(n,i,a))return;const L=(0,z.b)((0,c.vt)(),n,r,Math.sign(E));t.push(new X.HJ({targetPoint:m,constraint:new q.FX(n,(0,p._7)(L)),previousVertex:i,otherVertex:n,otherVertexType:X.pn.CENTER,selfSnappingType:e,isDraped:"on-the-ground"===(null===(l=a.elevationInfo)||void 0===l?void 0:l.mode)}))}}const M=(0,S.vt)(),F=(0,c.vt)();var I=i(59380);class b extends E{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return n;const{view:s}=this,o=i.vertices[0],a=i.vertices[r-1],l=(0,p.Lp)(o.pos,s,t),h=(0,p.Lp)(a.pos,s,t);return this._processCandidateProposal(l,h,e,t,n),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===r.vertices.length-1))return i;const{view:s}=this,o=(0,p.Lp)(n.leftEdge.leftVertex.pos,s,t),a=(0,p.Lp)(n.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,n,r){if(!this.exceedsShortLineThreshold(e,t,n))return;const s=(0,g.Cc)(k,(0,p.Xz)(e),(0,p.Xz)(t),.5),o=.5*(0,g.Io)((0,p.Xz)(e),(0,p.Xz)(t)),a=(0,V.Dh)(k,(0,p.Xz)(i),s,o),l=(0,p.de)((0,p.fA)(a[0],a[1],i[2])),{spatialReference:h,pointer:c}=n,u=(0,x.j)(i,h,d.qt,this.view);if((0,v.pM)(u,(0,x.j)(l,h,d.qt,this.view))<this.squaredProximityThreshold(c)){var f;if(this.isVertical(e,l,n)||this.isVertical(l,t,n))return;r.push(new I.R({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(f=n.elevationInfo)||void 0===f?void 0:f.mode)}))}}}const k=(0,S.vt)();var j=i(99791);let G=class extends r.default{constructor(e){super(e),this.updating=!1,this._snappers=new s.default,this._domain=j.n.SELF}initialize(){this._snappers.push(new P(this.view,this.options),new R(this.view,this.options),new C(this.view,this.options),new b(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const r of this._snappers.items)for(const t of r.snap(e,i))n.push(t);return(0,v.xX)(e,n),n}};(0,n._)([(0,o.MZ)({readOnly:!0})],G.prototype,"updating",void 0),(0,n._)([(0,o.MZ)({constructOnly:!0})],G.prototype,"view",void 0),(0,n._)([(0,o.MZ)()],G.prototype,"options",null),G=(0,n._)([(0,a.$)("esri.views.interactive.snapping.SelfSnappingEngine")],G)},89646:(e,t,i)=>{i.d(t,{$h:()=>f,Ef:()=>R,IP:()=>x,P1:()=>L,hF:()=>V,jQ:()=>m,rT:()=>_,rZ:()=>n,uR:()=>E});var n,r,s=i(73582),o=i(24648),a=i(31633),l=i(19555),h=i(72745),c=i(20664),d=i(9392),p=i(14487),u=i(7137),g=i(80963);function f(e,t){if(null==e||null==t)return;const i=v(e,t);return null!=i?(0,o.Wq)(i,"radians","geographic"):void 0}(r=n||(n={})).Absolute="absolute",r.Relative="relative",r.RelativeBilateral="relative-bilateral";const v=(()=>{const e=(0,d.vt)(),t=(0,d.vt)();return(i,n)=>{var r,s;return(0,c.i)(e,i.x,i.y,null!==(r=i.z)&&void 0!==r?r:0),(0,c.i)(t,n.x,n.y,null!==(s=n.z)&&void 0!==s?s:0),x(e,t,i.spatialReference,n.spatialReference)}})(),x=(()=>{const e=(0,h.vt)(),t=(0,d.vt)(),i=(0,d.vt)();return(n,r,s,o)=>{if((0,c.p)(n,r))return;const d=(0,u.geodesicCompatibleSpatialReference)(s),f=(0,u.geodesicCompatibleSpatialReference)(o);if(d&&f&&(0,g.aI)(d,f)&&(0,p.F)(n,s,t,d)&&(0,p.F)(r,o,i,f)){const{azimuth:e}=(0,u.inverseGeodeticSolver)(y,t,i,d);return null!=e?(0,a.oU)(e,"degrees","radians"):void 0}e[0]=r[0]-n[0],e[1]=r[1]-n[1];let v=(0,l.g7)(h.JP,e);return e[0]<0&&(v=P-v),v}})();function E(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.Absolute;if(t&&i)switch(r){case n.Absolute:return f(t,i);case n.Relative:return m(w(e,t,i),n.Relative);case n.RelativeBilateral:return m(w(e,t,i),n.RelativeBilateral)}}function w(e,t,i){if(!e||!t||!i)return;const n=v(e,t),r=v(t,i);return null!=n&&null!=r?(0,o.Wq)(r-n,"radians","geographic"):void 0}function m(e,t){if(null!=e)switch(t){case n.Absolute:return L(e);case n.Relative:{const t=V(e);let i=z.normalize(t,0,!0);return-180===i&&(i=180),(0,o.Wq)(i,"degrees","geographic")}case n.RelativeBilateral:{const t=V(e),i=Math.abs(z.normalize(t,0,!0));return(0,o.Wq)(i,"degrees","geographic")}}}function L(e){const t=V(e),i=T.normalize(t,0,!0);return(0,o.Wq)(i,"degrees","geographic")}const _=(()=>{const e=(0,d.vt)();return function(t,i,n,r,s){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,c.c)(e,i);const h=V(s);if("geodesic"===l){const s=(0,u.geodesicCompatibleSpatialReference)(n);if(s&&(0,p.F)(e,n,e,s))return(0,u.directGeodeticSolver)(t,e,h,r,s),t[2]=i[2],!!(0,p.F)(t,s,t,n)}const d=(0,o.g2)(h,"geographic","arithmetic"),g=(0,a.oU)(d,"degrees","radians"),f=i[0]+r*Math.cos(g),v=i[1]+r*Math.sin(g),x=i[2];return(0,c.i)(t,f,v,x),!0}})();function V(e){if(null!=e)return(0,o.g2)(S(e),e.rotationType,"geographic")}function R(e){if(null!=e)return(0,o.g2)(S(e),e.rotationType,"arithmetic")}function S(e){return(0,a.oU)(e.value,e.unit,"degrees")}const y=new u.InverseGeodeticSolverResult,P=2*Math.PI,T=s.ie,z=new s.hr(-180,180)}}]);
//# sourceMappingURL=67960.8af62b26.chunk.js.map